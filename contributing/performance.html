
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Performance &#8212; Katana</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Testing" href="testing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="http://170.187.252.217/docs/_static/favicon/favicon-16x16.png">
      
    
      
      <link rel="icon" sizes="32x32" href="http://170.187.252.217/docs/_static/favicon/favicon-32x32.png">
      
    
      
      <link rel="apple-touch-icon" sizes="152x152" href="http://170.187.252.217/docs/_static/favicon/apple-touch-icon-152x152.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    <div id="navbar-start">
        
        

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>


        
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
        <div class="thin-hamburger">
            <span></span>
            <span></span>
        </div>
    </button>

    <script>
        const hamburger = document.querySelector('.navbar-toggler');
        hamburger.addEventListener('click', function(e){
            hamburger.classList.toggle('hamburger-open');
        })
    </script>

    
    <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
        <div id="navbar-center" class="mr-auto">
            
            <div class="navbar-center-item">
                <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting-started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user-guides/index.html">
  User Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Contributing
 </a>
</li>

    
</ul>
            </div>
            
        </div>

        <div id="navbar-end">
            
            <div class="navbar-end-item">
                <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        latest  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables contributing/performance and {'json_url': 'https://docs.k9h.dev/switcher.json', 'url_template': 'https://docs.k9h.dev/{version}/', 'version_match': 'latest'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "contributing/performance.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.k9h.dev/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "contributing/performance.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.3.0.dev+28.0.44b856 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "latest") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
            </div>
            
        </div>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
    <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="7" cy="7" r="6.5" stroke="black"/>
        <line x1="11.7071" y1="12" x2="15.9497" y2="16.2426" stroke="black" stroke-linecap="round"/>
    </svg>
    <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
      <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting-started/index.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../user-guides/index.html">
   User Guides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guides/algorithms_in_python.html">
     Implementing an Algorithm in Katana Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guides/hello_world.html">
     First steps in Katana on One Host
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference/index.html">
   Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/cxx/index.html">
     C++ Library
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/arrow.html">
       Arrow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/error-handling.html">
       Error Handling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/logging.html">
       Logging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/property-graph.html">
       Property Graph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/strings.html">
       Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/tracing.html">
       Tracing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/python/index.html">
     Python Library
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.html">
       Katana
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../reference/python/katana.local.html">
       Katana Local API
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.graph.html">
         Graphs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.analytics.html">
         Analytics
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.import_data.html">
         Import Data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.atomic.html">
         Atomic Operations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.datastructures.html">
         Data Structures
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.analytics.html">
       Analytics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.atomic.html">
       Atomic Operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.datastructures.html">
       Data Structures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.graph.html">
       Graphs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.import_data.html">
       Import Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.timer.html">
       Performance Timers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.bug.html">
       Bug Reporting Tools
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Contributing
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="history.html">
     History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="codebase-overview.html">
     Quick Overview of the Codebase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="building.html">
     Building
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="git-style.html">
     Git Style
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="code-style.html">
     Code Style
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="restructured-text.html">
     Restructured Text
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="testing.html">
     Testing
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="documentation.html">
     Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="releases.html">
     Releases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tips-tricks.html">
     Helpful Tips and Tricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="rdg-storage-format.html">
     Katana RDG Storage Format
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="how-to-template.html">
     How-to guide template
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
  </nav>
  
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arrays-and-vectors">
   Arrays and Vectors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling">
   Profiling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cpu">
     CPU
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#memory">
     Memory
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="performance">
<h1>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">#</a></h1>
<section id="arrays-and-vectors">
<h2>Arrays and Vectors<a class="headerlink" href="#arrays-and-vectors" title="Permalink to this headline">#</a></h2>
<p>We have different specializations or types for arrays/vectors of
objects/elements that are efficient in different use cases. These types can be
differentiated along these dimensions:</p>
<dl class="simple">
<dt>Array/Vector</dt><dd><p>the abstraction that the type provides - a <em>vector</em> can be resized
dynamically and its allocation grows in powers-of-2, whereas an <em>array</em>
cannot be resized (i.e., its allocation size must be known at runtime).</p>
</dd>
<dt>Concurrent/Scalable Allocation</dt><dd><p>whether the type supports efficient concurrent allocation in a parallel
region.</p>
</dd>
<dt>NUMA-aware Allocation</dt><dd><p>whether the type supports allocation of objects in different NUMA
sockets/regions.</p>
</dd>
<dt>Uninitialized Allocation</dt><dd><p>whether the type does not initialize the objects during allocation.</p>
</dd>
<dt>Object Construction/Destruction</dt><dd><p>whether the type supports calling each object’s constructor/destructor.</p>
</dd>
<dt>Parallel Construction/Destruction</dt><dd><p>whether the type uses threads during its construction and destruction.</p>
</dd>
</dl>
<table class="table">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Array/Vector</p></td>
<td><p>Concurrent/Scalable Allocation</p></td>
<td><p>NUMA-aware Allocation</p></td>
<td><p>Uninitialized Allocation</p></td>
<td><p>Object Construction/Destruction</p></td>
<td><p>Parallel Construction/Destruction</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">std::vector</span></code></p></td>
<td><p>Vector</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">katana::gstl::Vector</span></code></p></td>
<td><p>Vector</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">katana::PODVector</span></code></p></td>
<td><p>Vector</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">katana::NUMAArray</span></code></p></td>
<td><p>Array</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>Here is a brief description of the specializations:</p>
<dl class="simple">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">katana::gstl::Vector</span></code></dt><dd><p>A specialization of <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> that uses a concurrent, scalable
allocator: the allocator is composed of thread-local allocators that manage
thread-local pages and only use a global lock to get allocation in chunks of
(huge) pages. When a <code class="docutils literal notranslate"><span class="pre">katana::gstl::Vector</span></code> is destroyed, its memory is
reclaimed by the thread that destroys it.</p>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">katana::PODVector</span></code></dt><dd><p>A specialization of <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> of plain-old-datatype (POD) objects that
does not initialize/construct or destruct the objects. It does not support
concurrent/scalable or NUMA-aware allocation.</p>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">katana::NUMAArray</span></code></dt><dd><p>An array of objects that is distributed among NUMA sockets/regions but
cannot be resized. Different NUMA-aware allocation policies are supported.
The allocation is uninitialized but objects of any type can be constructed
after allocation using member functions. Allocations and deallocations are
parallel operations because threads are used to allocate pages in each
thread’s NUMA region and destroy objects in parallel respectively.</p>
</dd>
</dl>
<p>Here is a rule of thumb to choose among these different options:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">katana::gstl::Vector</span></code> when allocations and deallocations can occur in
a parallel region. As the memory allocated can be reused for another
allocation only by the thread that deallocated it, this is not suitable for
use cases where the main thread always does the deallocation (after the
parallel region).</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">katana::PODVector</span></code> when the object type is a POD and when the
allocation is done in a serial region but the assignment/construction is done
in a parallel region. In other words, when <code class="docutils literal notranslate"><span class="pre">resize()</span></code> is done on the main
thread and values are assigned in parallel (instead of the typical
<code class="docutils literal notranslate"><span class="pre">reserve()</span></code> and <code class="docutils literal notranslate"><span class="pre">emplace_back()</span></code> on the main thread).</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">katana::NUMAArray</span></code> when the allocation size is large (in the order of
nodes/edges). Allocation size must be known at runtime (allocation cannot
grow dynamically). Allocations and deallocations must occur on the main
thread.</p></li>
</ul>
<p>Note the design space of the different dimensions is not yet fully explored. We
may create more specializations in the future when the need arises.</p>
</section>
<section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">#</a></h2>
<section id="cpu">
<h3>CPU<a class="headerlink" href="#cpu" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">perf</span></code> is a commonly available tool for profiling execution on Linux. You can
collect samples from any execution with <code class="docutils literal notranslate"><span class="pre">perf</span> <span class="pre">record</span> <span class="pre">&lt;command</span> <span class="pre">line</span> <span class="pre">to</span>
<span class="pre">profile&gt;</span></code> and then use <code class="docutils literal notranslate"><span class="pre">perf</span> <span class="pre">report</span></code> to view the report.</p>
<p>See <a class="reference external" href="https://www.brendangregg.com/perf.html">perf examples by Brendan Gregg</a>
for more.</p>
</section>
<section id="memory">
<h3>Memory<a class="headerlink" href="#memory" title="Permalink to this headline">#</a></h3>
<p>If you want to profile memory usage, you can enable <code class="docutils literal notranslate"><span class="pre">jemalloc</span></code> in the build
with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DKATANA_USE_JEMALLOC<span class="o">=</span>on &lt;other cmake options&gt;
</pre></div>
</div>
<p>This will replace the system <code class="docutils literal notranslate"><span class="pre">malloc</span></code> implementation with <code class="docutils literal notranslate"><span class="pre">jemalloc</span></code>, and
with <code class="docutils literal notranslate"><span class="pre">jemalloc</span></code>, you can produce heap profiles.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The standard conda package for jemalloc does not enable profiling. You need
to use a conan build instead.</p>
</div>
<p>To enable profiles, you must also put <code class="docutils literal notranslate"><span class="pre">prof:true</span></code> in the environment variable
<code class="docutils literal notranslate"><span class="pre">MALLOC_CONF</span></code>. Additional options can be passed to <code class="docutils literal notranslate"><span class="pre">jemalloc</span></code> by separating
options with a comma.</p>
<p>By default, heap profiles are produced only when explicitly requested like with
<a class="reference internal" href="../reference/cxx/tracing.html#_CPPv4N6katana12ProgressSpan10LogProfileEv" title="katana::ProgressSpan::LogProfile"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">katana::ProgressSpan::LogProfile()</span></code></a>.</p>
<p>Alternatively, you can ask <code class="docutils literal notranslate"><span class="pre">jemalloc</span></code> to produce a heap profile every <strong>k</strong>
bytes of allocation. For example, the following configuration will produce a
profile every 1GB of allocation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># log2(1GB) = 30</span>
<span class="nb">export</span> <span class="nv">MALLOC_CONF</span><span class="o">=</span>prof:true,lg_prof_interval:30
&lt;<span class="nb">command</span> line&gt;
</pre></div>
</div>
<p>Heap profiles (<code class="docutils literal notranslate"><span class="pre">jeprof.*</span></code>) are written to the current working directory of
the executable.</p>
<p>You can analyze a profile with <code class="docutils literal notranslate"><span class="pre">jeprof</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jeprof --web &lt;executable&gt; &lt;heap profile&gt;
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/jemalloc/jemalloc/wiki">jemalloc wiki</a> contains more
information.</p>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Katana Graph, Inc. 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>