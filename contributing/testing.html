
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Testing &#8212; Katana</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performance" href="performance.html" />
    <link rel="prev" title="Restructured Text" href="restructured-text.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="http://170.187.252.217/docs/_static/favicon/favicon-16x16.png">
      
    
      
      <link rel="icon" sizes="32x32" href="http://170.187.252.217/docs/_static/favicon/favicon-32x32.png">
      
    
      
      <link rel="apple-touch-icon" sizes="152x152" href="http://170.187.252.217/docs/_static/favicon/apple-touch-icon-152x152.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    <div id="navbar-start">
        
        

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>


        
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
        <div class="thin-hamburger">
            <span></span>
            <span></span>
        </div>
    </button>

    <script>
        const hamburger = document.querySelector('.navbar-toggler');
        hamburger.addEventListener('click', function(e){
            hamburger.classList.toggle('hamburger-open');
        })
    </script>

    
    <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
        <div id="navbar-center" class="mr-auto">
            
            <div class="navbar-center-item">
                <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting-started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user-guides/index.html">
  User Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Contributing
 </a>
</li>

    
</ul>
            </div>
            
        </div>

        <div id="navbar-end">
            
            <div class="navbar-end-item">
                <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        latest  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables contributing/testing and {'json_url': 'https://docs.k9h.dev/switcher.json', 'url_template': 'https://docs.k9h.dev/{version}/', 'version_match': 'latest'}.
-->

<script type="text/javascript">
// Construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://docs.k9h.dev/{version}/";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "contributing/testing.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.k9h.dev/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "contributing/testing.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            // get the base URL for that doc version, add the current page's
            // path to it, and set as `href`
            entry.url = buildURL(entry);
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.1.102.dev+241.0.38fb5d variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "latest") {
                node.classList.add("active");
                $("#version_switcher_button").text(entry.name);
            }
        });
    });
})();
</script>
            </div>
            
        </div>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
    <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="7" cy="7" r="6.5" stroke="black"/>
        <line x1="11.7071" y1="12" x2="15.9497" y2="16.2426" stroke="black" stroke-linecap="round"/>
    </svg>
    <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
      <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting-started/index.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../user-guides/index.html">
   User Guides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guides/algorithms_in_python.html">
     Implementing an Algorithm in Katana Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guides/hello_world.html">
     First steps in Katana on One Host
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference/index.html">
   Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/cxx/index.html">
     C++ Library
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/arrow.html">
       Arrow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/error-handling.html">
       Error Handling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/logging.html">
       Logging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/property-graph.html">
       Property Graph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/strings.html">
       Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/cxx/tracing.html">
       Tracing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/python/index.html">
     Python Library
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.html">
       Katana
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../reference/python/katana.local.html">
       Katana Local API
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.graph.html">
         Graphs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.analytics.html">
         Analytics
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.import_data.html">
         Import Data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.atomic.html">
         Atomic Operations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../reference/python/katana.local.datastructures.html">
         Data Structures
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.analytics.html">
       Analytics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.atomic.html">
       Atomic Operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.datastructures.html">
       Data Structures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.graph.html">
       Graphs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.local.import_data.html">
       Import Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.timer.html">
       Performance Timers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/python/katana.bug.html">
       Bug Reporting Tools
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Contributing
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="history.html">
     History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="codebase-overview.html">
     Quick Overview of the Codebase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="building.html">
     Building
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="git-style.html">
     Git Style
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="code-style.html">
     Code Style
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="restructured-text.html">
     Restructured Text
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="performance.html">
     Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="documentation.html">
     Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="releases.html">
     Releases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tips-tricks.html">
     Helpful Tips and Tricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="rdg-storage-format.html">
     Katana RDG Storage Format
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="how_to_template.html">
     How-to guide template
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
  </nav>
  
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-inputs">
   Test Inputs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-inputs-with-cmake-tests">
     Using inputs with CMake tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-inputs-with-python-tests-and-notebooks">
     Using inputs with python tests and notebooks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running">
   Running
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notebooks">
     Notebooks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coverage">
   Coverage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python">
     Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c">
     C++
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#debugging">
   Debugging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dealing-with-errors-in-ci">
   Dealing with Errors in CI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manually-controlling-ci-jobs">
   Manually Controlling CI Jobs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#caching-in-ci">
   Caching in CI
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Tests are just executables created by the CMake <code class="docutils literal notranslate"><span class="pre">add_test</span></code> command.  A test
succeeds if it can be run and it returns a zero exit value; otherwise, the test
execution is considered a failure. A test executable itself may contain many
individual assertions and subtests.</p>
<p>Tests are divided into groups by their label property. A test can be given a
label with the <code class="docutils literal notranslate"><span class="pre">set_property</span></code>/<code class="docutils literal notranslate"><span class="pre">set_tests_properties</span></code> command, e.g.,
<code class="docutils literal notranslate"><span class="pre">set_property(TEST</span> <span class="pre">my-test</span> <span class="pre">PROPERTY</span> <span class="pre">LABEL</span> <span class="pre">my-label)</span></code></p>
<p>Labels:</p>
<ul class="simple">
<li><p><strong>quick</strong>: Quick tests have no external dependencies and can be run in parallel
with other quick tests. Each quick test should run in a second or less. These
tests are run as part of our continuous integration pipeline.</p></li>
<li><p><strong>gpu</strong>: Tests that require a GPU.</p></li>
</ul>
<section id="test-inputs">
<h2>Test Inputs<a class="headerlink" href="#test-inputs" title="Permalink to this headline">¶</a></h2>
<p>Many tests require sample graphs that are too big to keep in this repository.
Test datasets are located in the <cite>katana/external/test-datasets</cite> submodule, which is
the <a class="reference external" href="https://github.com/KatanaGraph/test-datasets">https://github.com/KatanaGraph/test-datasets</a> git repo</p>
<p>If you need to update one of the test datasets, first make a commit to that repo,
then ensure you have your changes checked out in <cite>katana/external/test-datasets</cite>
Include <cite>katana/external/test-datasets</cite> in a commit to your katana repo
Finally, you must also update the <cite>DATASETS_SHA</cite> in
<cite>python/katana/example_data.py</cite> so that notebooks, CI, and users without the
source available have access to the correct test datasets.</p>
<p>If you are new to git submodules, this documentation may be helpful:
<a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">https://git-scm.com/book/en/v2/Git-Tools-Submodules</a></p>
<p>Tests using test inputs should make a temporary copy of that input to avoid
dirtying the inputs for other tests.</p>
<section id="using-inputs-with-cmake-tests">
<h3>Using inputs with CMake tests<a class="headerlink" href="#using-inputs-with-cmake-tests" title="Permalink to this headline">¶</a></h3>
<p>To avoid hardcoding the path to an input in tests
<cite>katana/cmake/Modules/TestDatasets.cmake</cite> defines variables for common test inputs,
as well as functions for managing RDG test inputs</p>
<p>For csv and miscellaneous test inputs <cite>CSV_TEST_DATASETS</cite> and <cite>MISC_TEST_DATASETS</cite> can be used
instead of hard coding their exact location</p>
<p>For RDG test inputs, the <cite>RDG_*</cite> variables can be used to get the latest storage_format_version
of commonly used RDGs. If you don’t know if you need a specific storage_format_version RDG, do not specify it
so that the latest is always used.</p>
<dl class="simple">
<dt>Two additional functions are available for locating RDG test inputs if they do not already have a <cite>RDG_*</cite> variable:</dt><dd><ul class="simple">
<li><p><cite>rdg_dataset()</cite></p></li>
<li><p><cite>rdg_dataset_at_version()</cite></p></li>
</ul>
</dd>
</dl>
</section>
<section id="using-inputs-with-python-tests-and-notebooks">
<h3>Using inputs with python tests and notebooks<a class="headerlink" href="#using-inputs-with-python-tests-and-notebooks" title="Permalink to this headline">¶</a></h3>
<p>To avoid hardcoding the path or url to an input in tests, the enterprise and open katana repos provide
test input helper functions.</p>
<dl class="simple">
<dt>For tests located in the enterprise repo, <cite>katana-enterprise/python/test/datasets.py</cite> provides the following functions</dt><dd><ul class="simple">
<li><p><cite>rdg_dataset_url()</cite></p></li>
<li><p><cite>csv_dataset_url()</cite></p></li>
<li><p><cite>misc_dataset_url()</cite></p></li>
</ul>
</dd>
</dl>
<p>These take the name of the desired input and a datasource and provide a <cite>file://</cite>, <cite>gs://</cite>, or <cite>aws://</cite> url</p>
<p>Common inputs like <cite>LDBC003</cite> and <cite>Movies</cite> also have dataset classes defined for them which can be used.</p>
<p>For tests requiring only local inputs, or only testing the open source katana repo
<cite>katana/python/katana/example_data.py</cite> provides the following functions
which take the name of the test input, and return its path. These will only work for
local test inputs, not inputs located on gcp/aws.</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>get_misc_dataset()</cite></p></li>
<li><p><cite>get_csv_dataset()</cite></p></li>
<li><p><cite>get_rdg_dataset()</cite></p></li>
</ul>
</div></blockquote>
<p>all take an optional <cite>as_url=True/False</cite> which will cause the function to return
a <cite>file://</cite> url instead of a standard unix/posix path</p>
</section>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>All tests can be run with <code class="docutils literal notranslate"><span class="pre">ctest</span></code>.</p>
<p>To run all quick tests,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest -L quick
</pre></div>
</div>
<p>To run tests whose names match <code class="docutils literal notranslate"><span class="pre">regex</span></code>, with verbose output, and with <code class="docutils literal notranslate"><span class="pre">4</span></code>
tests running in parallel at a time,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest -R regex -V --parallel <span class="m">4</span>
</pre></div>
</div>
<p>To run tests with valgrind memcheck,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest --test-action memcheck
</pre></div>
</div>
<p>To rerun just the tests that failed during the last test run,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest --rerun-failed
</pre></div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">ctest</span></code> is the main way to run C++ tests and <code class="docutils literal notranslate"><span class="pre">ctest</span></code> will run tests for Python code. It is
also possible to run Python tests directly with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running tests</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest python/test

<span class="c1"># Running tests in one file</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest python/test/my_test_file.py

<span class="c1"># Running one test</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest python/test/my_test_file.py::my_test

<span class="c1"># Running all tests with a given marker (similar to ctest labels)</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest -m my_marker python/test

<span class="c1"># Run pytest verbosely (-v), do not capture output (-s) and select tests</span>
<span class="c1"># matching the filter (-k)</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest -v -s -k my_test python/test

<span class="c1"># Running tests with a more sophisticated filter</span>
<span class="c1"># -k expressions can include python operators and can match</span>
<span class="c1"># against functions, classes, or even files</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest -k <span class="s1">&#39;my_test and not YourClass&#39;</span> python/test
</pre></div>
</div>
<p>To run Python tests on katana cluster deployed in GCP:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run tests on katana cluster deployed in GCP</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh pytest python/test --datasource gcp
</pre></div>
</div>
<section id="notebooks">
<h3>Notebooks<a class="headerlink" href="#notebooks" title="Permalink to this headline">¶</a></h3>
<p>Some of the tests run a notebook and check to see if the computed output matches the output saved in the notebook.</p>
<p>If you want to automatically update the saved output of a notebook to match the computed output, you can pass the <code class="docutils literal notranslate"><span class="pre">--nb-force-regen</span></code> flag to update the notebook output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$BUILD_DIR</span>/python_env.sh pytest -k my_test --nb-force-regen python/test
</pre></div>
</div>
<p>In some cases, the output of the notebook can vary from run to run. To skip checking the output of a particular cell, you can add <code class="docutils literal notranslate"><span class="pre">nbreg</span></code> metadata to a cell in the notebook file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;cell_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;nbreg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="nt">&quot;diff_ignore&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/outputs/0/data/text/plain&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;text/plain&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">     </span><span class="s2">&quot;&lt;output to ignore&gt;&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://pytest-notebook.readthedocs.io/en/latest/user_guide/tutorial_config.html">pytest-notebook
documentation</a>
for more options.</p>
</section>
</section>
<section id="coverage">
<h2>Coverage<a class="headerlink" href="#coverage" title="Permalink to this headline">¶</a></h2>
<p>Collecting coverage is enabled for Python and C++.</p>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Export <code class="docutils literal notranslate"><span class="pre">COVERAGE_RCFILE</span></code> before running the build command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">COVERAGE_RCFILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SRC_DIR</span><span class="s2">/.coveragerc&quot;</span>
</pre></div>
</div>
<p>Once the build step is done, you can use the following sequence of
commands to run tests and obtain (html) coverage report:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">COVERAGE_PROCESS_START</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$COVERAGE_RCFILE</span><span class="s2">&quot;</span>
<span class="nv">$BUILD_DIR</span>/python_env.sh coverage run -m pytest python/test -s
coverage combine
coverage html
</pre></div>
</div>
<p>The output is available in <code class="docutils literal notranslate"><span class="pre">$(pwd)/pythoncov</span></code>.</p>
</section>
<section id="c">
<h3>C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<p>Include the following options when running the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command
(i.e., when configuring your build):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DKATANA_USE_COVERAGE<span class="o">=</span>ON -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug
</pre></div>
</div>
<p>After the build is done, binaries will be instrumented to collect
profiling data.</p>
<p>Now you can run any test that you wish.  For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest -L quick
</pre></div>
</div>
<p>There are several tools you can use to process obtained profiling data
after test run.  One popular tool is <code class="docutils literal notranslate"><span class="pre">gcovr</span></code>.  You can obtain (html)
report by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$SRC_DIR</span>
gcovr -r . --html --html-medium-threshold<span class="o">=</span><span class="m">50</span>
</pre></div>
</div>
</section>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Printing and its more production-oriented cousin, logging, are simple ways to
get started with debugging, especially if you are in an environment where you
can build executables from source. Just remember to prefix your debugging messages
with an easy-to-find string like <cite>XXX</cite> so you can find and remove them later.</p>
<p>For more interactive debugging, you can use <cite>gdb</cite>. A typical <cite>gdb</cite> session looks
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdb</span> <span class="o">--</span><span class="n">args</span> <span class="n">application</span> <span class="n">arg1</span> <span class="n">arg2</span> <span class="n">arg3</span>
<span class="o">&gt;</span> <span class="k">break</span> <span class="n">SourceFile</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="n">LineNumber</span>
<span class="o">&gt;</span> <span class="n">run</span>
<span class="o">&gt;</span> <span class="nb">next</span>
<span class="o">&gt;</span> <span class="nb">print</span>
<span class="c1"># edit some code</span>
<span class="o">&gt;</span> <span class="n">make</span>
<span class="o">&gt;</span> <span class="n">run</span>
</pre></div>
</div>
<p>If you are debugging an MPI application, you can use a command like <cite>mpirun -np
4 xterm -e gdb application</cite> to spawn a <cite>gdb</cite> session for each MPI host or use
[tmpi](<a class="reference external" href="https://github.com/Azrael3000/tmpi">https://github.com/Azrael3000/tmpi</a>) which will spawn <cite>gdb</cite> sessions in
<cite>tmux</cite> panes instead of <cite>xterm</cite> windows. These commands work best if all the
MPI processes are running on the same machine. If not, you will have to work
out how to open connections to each worker machine. The OpenMPI project gives
some [pointers](<a class="reference external" href="https://www.open-mpi.org/faq/?category=debugging">https://www.open-mpi.org/faq/?category=debugging</a>), but in
practice, it is usually easier to fallback to print-statement debugging or
trying to reproduce your issue on a single host if possible.</p>
<p>An alternative to running a debugger is to load a core dump. Most machines
disable core dumps by default, but you can enable them with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ulimit</span> <span class="o">-</span><span class="n">c</span> <span class="n">unlimited</span>
<span class="n">sudo</span> <span class="n">sysctl</span> <span class="o">-</span><span class="n">w</span> <span class="n">kernel</span><span class="o">.</span><span class="n">core_pattern</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">core</span><span class="o">-%</span><span class="n">e</span><span class="o">.%</span><span class="n">p</span><span class="o">.%</span><span class="n">h</span><span class="o">.%</span><span class="n">t</span>
</pre></div>
</div>
<p>And you can load them in <cite>gdb</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdb</span> <span class="n">application</span> <span class="o">-</span><span class="n">c</span> <span class="n">core</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
</section>
<section id="dealing-with-errors-in-ci">
<h2>Dealing with Errors in CI<a class="headerlink" href="#dealing-with-errors-in-ci" title="Permalink to this headline">¶</a></h2>
<p>If the error is due to a transient external failure, you can re-run jobs in the
GitHub UI.</p>
<p>When debugging a CI failure, it is good to confirm that tests pass locally in
your developer environment first. The CI runs on the merge of your PR and the
branch you want to merge with (usually master), so if you have issues
reproducing locally make sure your PR branch is up to date as well.</p>
<p>You can also run many of the source checks locally as well (usually
<code class="docutils literal notranslate"><span class="pre">scripts/check_*</span></code>), and most of them accept a <code class="docutils literal notranslate"><span class="pre">-fix</span></code> option to automatically
correct the errors they check for. Take a look at the GitHub workflow
definitions under <code class="docutils literal notranslate"><span class="pre">.github</span></code> directory to see what script and build parameters
are used.</p>
</section>
<section id="manually-controlling-ci-jobs">
<h2>Manually Controlling CI Jobs<a class="headerlink" href="#manually-controlling-ci-jobs" title="Permalink to this headline">¶</a></h2>
<p>You can disable CI jobs selectively on a given PR using “magic words” in the PR
body text. All magic words are case-insensitive. Changing the magic words will
not cause jobs to run. You will need to manually trigger the jobs to runs again
either by triggering a rerun as above or by pushing a new commit.</p>
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Magic Word</p></td>
<td><p>Jobs Skipped</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">test]</span></code></p></td>
<td><p>build and test jobs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">package]</span></code></p></td>
<td><p>packaging jobs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">Python]</span></code></p></td>
<td><p>all Python jobs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">Python</span> <span class="pre">test]</span></code></p></td>
<td><p>Python build and test jobs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">Python</span> <span class="pre">package]</span></code></p></td>
<td><p>Python packaging jobs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">C++]</span></code></p></td>
<td><p>all C++ jobs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">C++</span> <span class="pre">test]</span></code></p></td>
<td><p>C++ build and test jobs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[no</span> <span class="pre">C++</span> <span class="pre">package]</span></code></p></td>
<td><p>C++ packaging jobs</p></td>
</tr>
</tbody>
</table>
<p>Github natively supports disabling CI entirely for specific commits as
documented at:
<a class="reference external" href="https://docs.github.com/en/actions/guides/about-continuous-integration#skipping-workflow-runs">https://docs.github.com/en/actions/guides/about-continuous-integration#skipping-workflow-runs</a></p>
</section>
<section id="caching-in-ci">
<h2>Caching in CI<a class="headerlink" href="#caching-in-ci" title="Permalink to this headline">¶</a></h2>
<p>GitHub actions allows for build data to be cached between CI runs. For
reference, the caches (<code class="docutils literal notranslate"><span class="pre">actions/cache</span></code>) are scoped to
[branches](<a class="reference external" href="https://github.com/actions/cache#cache-scopes">https://github.com/actions/cache#cache-scopes</a>). The cache matching
policy is:</p>
<ol class="arabic simple">
<li><p>Exact key match on the current branch</p></li>
<li><p>Prefix match of a restore key on the current branch. If there are multiple
matching keys, return the most recent entry.</p></li>
<li><p>Repeat from 1 for the default branch</p></li>
</ol>
<p>Keys should be unique because once a cache entry is created it will
never be updated by <code class="docutils literal notranslate"><span class="pre">actions/cache</span></code>.</p>
<p>If you need to create a cache that simply stores the latest values, create a
common prefix with a unique suffix (e.g., <code class="docutils literal notranslate"><span class="pre">github.sha</span></code>) and use the common
prefix as a restore key. The unique key will not match any existing key but
upon lookup there will be multiple matching cache entries sharing the common
prefix, and <code class="docutils literal notranslate"><span class="pre">actions/cache</span></code> will return the most recent one.</p>
<p>One common use of <code class="docutils literal notranslate"><span class="pre">actions/cache</span></code> is to store a ccache cache. There is no limit
on the number of caches, but once the overall size of a cache exceeds 5 GB
(compressed), GitHub will start evicting old entries. 5 GB isn’t particularly
large for a ccache so we currently manually limit the size of each ccache to a
certain number of files (<code class="docutils literal notranslate"><span class="pre">ccache</span> <span class="pre">--max-files</span></code>) to more directly control cache
behavior and ensure fairer eviction among GitHub caches. The downside is these
limits need to be periodically reassessed.</p>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Katana Graph, Inc. 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>